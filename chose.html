<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥¢è¯é‡‘å±¬è½‰ç›¤ - éŸ³æ•ˆä¿®æ­£ç‰ˆ</title>
    <style>
        :root {
            --gold: linear-gradient(135deg, #f1c40f 0%, #f39c12 100%);
            --dark-metal: #2c3e50;
        }
        body { font-family: sans-serif; background: #1a1a1a; color: white; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        
        /* å®¹å™¨ */
        .container { 
            max-width: 500px; width: 100%; background: #ffffff; color: #333;
            padding: 30px; border-radius: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            text-align: center; 
        }

        /* æ¨™é¡Œèˆ‡æ¨™ç±¤ */
        input[type="text"] { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 12px; font-size: 16px; margin: 10px 0; box-sizing: border-box; }
        .tag-container { display: flex; flex-wrap: wrap; gap: 8px; margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 12px; min-height: 40px; }
        .tag { background: var(--dark-metal); color: white; padding: 6px 15px; border-radius: 50px; font-size: 14px; display: flex; align-items: center; }
        .tag .remove-btn { margin-left: 10px; cursor: pointer; color: #ff4757; }

        /* è½‰ç›¤å¤–è§€ */
        .wheel-outer {
            position: relative; margin: 40px auto; width: 340px; height: 340px;
            border: 10px solid #333; border-radius: 50%;
            background: #333; box-shadow: 0 0 20px rgba(241,196,15,0.4);
        }
        .luxury-pointer {
            position: absolute; top: -20px; left: 50%; transform: translateX(-50%);
            width: 45px; height: 55px; z-index: 100; filter: drop-shadow(0 4px 4px rgba(0,0,0,0.3));
        }
        canvas { width: 340px; height: 340px; border-radius: 50%; transition: transform 5s cubic-bezier(0.1, 0, 0.1, 1); }
        .wheel-center {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 30px; height: 30px; background: white; border: 4px solid #f1c40f; border-radius: 50%; z-index: 10;
        }

        /* æŒ‰éˆ• */
        .spin-btn { 
            background: var(--gold); color: white; border: none; padding: 18px 50px; 
            font-size: 1.3rem; font-weight: bold; border-radius: 50px; cursor: pointer;
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.4); width: 100%;
        }
        .spin-btn:disabled { background: #ccc; cursor: not-allowed; }

        /* å½ˆçª— */
        .modal-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.9); display: none; justify-content: center; align-items: center; z-index: 1000; 
        }
        .modal { 
            background: white; padding: 40px; border-radius: 25px; text-align: center;
            border: 4px solid #f1c40f; transform: scale(0.8); transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .modal.active { transform: scale(1); }
        .winner-display { font-size: 3rem; color: #d35400; font-weight: 900; margin: 20px 0; display: block; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="margin:0 0 10px 0;">ğŸ¡ æŠ½çè¨­å®š</h2>
    <input type="text" id="titleInput" value="å°¾ç‰™å¹¸é‹æŠ½">
    
    <div class="tag-container" id="tagContainer"></div>
    <div style="display:flex; gap:10px; margin-bottom: 20px;">
        <input type="text" id="nameInput" placeholder="è¼¸å…¥åå­—..." style="margin:0">
        <button onclick="addName()" style="background:#2ecc71; color:white; border:none; padding:0 20px; border-radius:12px; cursor:pointer;">+</button>
    </div>

    <div class="wheel-outer">
        <svg class="luxury-pointer" viewBox="0 0 100 120">
            <path d="M50 120 L90 40 A40 40 0 1 0 10 40 Z" fill="#f1c40f" stroke="#fff" stroke-width="2"/>
        </svg>
        <div class="wheel-center"></div>
        <canvas id="wheelCanvas"></canvas>
    </div>

    <button id="spinBtn" class="spin-btn" onclick="handleSpinClick()">é–‹å§‹æŠ½ç</button>
</div>

<div id="modalOverlay" class="modal-overlay">
    <div class="modal" id="modal">
        <h2>ğŸŠ æ­å–œç²ç ğŸŠ</h2>
        <p id="resTitleDisplay" style="color:#666;"></p>
        <span class="winner-display" id="winnerName"></span>
        <button class="spin-btn" style="padding:10px 30px" onclick="closeModal()">å¤ªæ£’äº†</button>
    </div>
</div>

<audio id="tickSound" preload="auto" src="https://assets.mixkit.co/active_storage/sfx/2005/2005-preview.mp3"></audio>
<audio id="winSound" preload="auto" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3"></audio>

<script>
    const canvas = document.getElementById('wheelCanvas');
    const ctx = canvas.getContext('2d');
    const tickSound = document.getElementById('tickSound');
    const winSound = document.getElementById('winSound');
    const spinBtn = document.getElementById('spinBtn');
    
    let names = ['å¼µæ›‰æ˜', 'æå¤§åŒ', 'ç‹å°ç¾', 'é™³é˜¿ä¸‰', 'è¶™å°å…­'];
    let currentRotation = 0;
    const colors = ['#FF5E5E', '#45AAF2', '#A55EEA', '#F7B731', '#26DE81', '#FD9644', '#2BCBBA'];

    function setupCanvas() {
        const dpr = window.devicePixelRatio || 2;
        canvas.width = 340 * dpr;
        canvas.height = 340 * dpr;
        ctx.scale(dpr, dpr);
        drawWheel();
    }

    function renderTags() {
        const container = document.getElementById('tagContainer');
        container.innerHTML = '';
        names.forEach((name, i) => {
            const tag = document.createElement('div');
            tag.className = 'tag';
            tag.innerHTML = `${name} <span class="remove-btn" onclick="removeName(${i})">Ã—</span>`;
            container.appendChild(tag);
        });
        drawWheel();
    }

    function addName() {
        const input = document.getElementById('nameInput');
        if (input.value.trim()) {
            names.push(input.value.trim());
            input.value = '';
            renderTags();
        }
    }

    function removeName(i) { names.splice(i, 1); renderTags(); }

    function drawWheel() {
        const n = names.length;
        if (n === 0) return;
        const arc = (Math.PI * 2) / n;
        ctx.clearRect(0, 0, 340, 340);
        names.forEach((name, i) => {
            const angle = i * arc;
            ctx.beginPath();
            ctx.fillStyle = colors[i % colors.length];
            ctx.moveTo(170, 170);
            ctx.arc(170, 170, 170, angle, angle + arc);
            ctx.fill();
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 1;
            ctx.stroke();

            ctx.save();
            ctx.translate(170, 170);
            ctx.rotate(angle + arc / 2);
            ctx.textAlign = "right";
            ctx.fillStyle = "white";
            ctx.font = "bold 18px sans-serif";
            ctx.fillText(name, 155, 6);
            ctx.restore();
        });
    }

    // é—œéµä¿®æ­£ï¼šé€éä½¿ç”¨è€…ç¬¬ä¸€æ¬¡é»æ“Šï¼Œå¼·åˆ¶è§£é–æ‰€æœ‰éŸ³è¨Š
    function handleSpinClick() {
        // è§£é–éŸ³è¨Š (åœ¨æŸäº›æ‰‹æ©Ÿä¸Šå¿…é ˆå…ˆ play å† pause)
        tickSound.play().then(() => {
            tickSound.pause();
            tickSound.currentTime = 0;
            spin(); // çœŸæ­£åŸ·è¡Œæ—‹è½‰
        }).catch(e => {
            // å¦‚æœç€è¦½å™¨é‚„æ˜¯æ””æˆªï¼Œå°±ç›´æ¥è½‰
            spin();
        });
        
        winSound.play().then(() => {
            winSound.pause();
            winSound.currentTime = 0;
        });
    }

    function spin() {
        if (names.length < 2) return;
        spinBtn.disabled = true;

        const duration = 5000;
        const rounds = 7 + Math.floor(Math.random() * 5);
        const extraDegrees = Math.floor(Math.random() * 360);
        const totalDegree = rounds * 360 + extraDegrees;
        
        currentRotation += totalDegree;
        canvas.style.transform = `rotate(${currentRotation}deg)`;

        // æ¨¡æ“¬æ»´ç­”è²é‚è¼¯
        let lastTickAngle = 0;
        const n = names.length;
        const sliceDeg = 360 / n;
        let start = null;

        function playTicks(timestamp) {
            if (!start) start = timestamp;
            const elapsed = timestamp - start;
            
            // è¨ˆç®—ç•¶å‰æ—‹è½‰äº†å¤šå°‘åº¦ (ä½¿ç”¨ç°¡æ˜“ç·©å‹•å‡½æ•¸æ¨¡æ“¬æ—‹è½‰é€²åº¦)
            const progress = elapsed / duration;
            const easeOut = 1 - Math.pow(1 - progress, 3); // æ¨¡æ“¬è½‰ç›¤æ¸›é€Ÿ
            const currentStepDeg = totalDegree * easeOut;
            
            // æ¯ç•¶è½‰éä¸€å€‹æ‰‡å€é‚Šç•Œï¼Œå°±éŸ¿ä¸€æ¬¡
            if (currentStepDeg - lastTickAngle >= sliceDeg) {
                tickSound.currentTime = 0;
                tickSound.play().catch(()=>{});
                lastTickAngle = currentStepDeg;
            }

            if (elapsed < duration) {
                requestAnimationFrame(playTicks);
            }
        }
        requestAnimationFrame(playTicks);

        setTimeout(() => {
            const actualRotation = currentRotation % 360;
            const winningIndex = Math.floor((360 - (actualRotation % 360) + 270) % 360 / sliceDeg);
            showResult(names[winningIndex]);
        }, duration);
    }

    function showResult(winner) {
        winSound.play();
        document.getElementById('winnerName').innerText = winner;
        document.getElementById('resTitleDisplay').innerText = document.getElementById('titleInput').value;
        document.getElementById('modalOverlay').style.display = 'flex';
        setTimeout(() => document.getElementById('modal').classList.add('active'), 50);
    }

    function closeModal() {
        document.getElementById('modal').classList.remove('active');
        setTimeout(() => {
            document.getElementById('modalOverlay').style.display = 'none';
            spinBtn.disabled = false;
        }, 300);
    }

    window.onload = setupCanvas;
    renderTags();
</script>

</body>
</html>
