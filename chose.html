<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜ç•«è³ªéŸ³æ•ˆæŠ½çè½‰ç›¤</title>
    <style>
        :root {
            --primary: #ff4757;
            --secondary: #2f3542;
            --bg: #f1f2f6;
        }
        body { font-family: sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 20px; }
        
        .container { max-width: 500px; width: 100%; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; }
        
        /* æ¨™é¡Œèˆ‡æ¨™ç±¤ç·¨è¼¯å€ */
        .config-section { margin-bottom: 20px; text-align: left; }
        input[type="text"] { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 10px; margin-top: 5px; box-sizing: border-box; font-size: 16px; }
        
        .tag-container { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; min-height: 40px; padding: 10px; background: #fafafa; border-radius: 10px; border: 1px dashed #ccc; }
        .tag { background: var(--secondary); color: white; padding: 5px 12px; border-radius: 20px; display: flex; align-items: center; font-size: 14px; }
        .tag .remove-btn { margin-left: 8px; cursor: pointer; font-weight: bold; color: #ff6b81; }
        
        .add-group { display: flex; gap: 5px; margin-top: 10px; }
        .add-group input { flex: 1; }
        .btn-plus { background: #2ed573; color: white; border: none; width: 45px; border-radius: 10px; cursor: pointer; font-size: 20px; }

        /* è½‰ç›¤å€ */
        .wheel-wrapper { position: relative; margin: 30px auto; width: 320px; height: 320px; }
        .pointer { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 40px; z-index: 10; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
        canvas { width: 320px; height: 320px; transition: transform 4s cubic-bezier(0.15, 0, 0.15, 1); }

        .spin-btn { background: var(--primary); color: white; border: none; padding: 15px 50px; font-size: 1.2rem; font-weight: bold; border-radius: 50px; cursor: pointer; box-shadow: 0 5px 15px rgba(255, 71, 87, 0.4); }
        .spin-btn:disabled { background: #ccc; box-shadow: none; }

        /* å½ˆçª— */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 100; }
        .modal { background: white; padding: 40px; border-radius: 24px; text-align: center; transform: scale(0); transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .modal.active { transform: scale(1); }
        .modal h2 { color: #ffa502; font-size: 2rem; margin: 0; }
        .modal .winner { font-size: 2.5rem; display: block; margin: 20px 0; color: var(--secondary); font-weight: 900; }
    </style>
</head>
<body>

<div class="container">
    <div class="config-section">
        <label><b>ğŸ† æŠ½çæ¨™é¡Œ</b></label>
        <input type="text" id="titleInput" value="å¹¸é‹å¤§è½‰ç›¤">
        
        <label style="display:block; margin-top:15px;"><b>ğŸ‘¥ åå–®ç®¡ç†</b></label>
        <div class="tag-container" id="tagContainer"></div>
        <div class="add-group">
            <input type="text" id="nameInput" placeholder="è¼¸å…¥åå­—..." onkeypress="if(event.key==='Enter') addName()">
            <button class="btn-plus" onclick="addName()">+</button>
        </div>
    </div>

    <div class="wheel-wrapper">
        <img class="pointer" src="https://cdn-icons-png.flaticon.com/512/2985/2985150.png">
        <canvas id="wheelCanvas"></canvas>
    </div>

    <button id="spinBtn" class="spin-btn" onclick="spin()">é–‹å§‹æ—‹è½‰</button>
</div>

<div id="modalOverlay" class="modal-overlay">
    <div class="modal" id="modal">
        <h2>ğŸ‰ æ­å–œä¸­ç ğŸ‰</h2>
        <p>ã€<span id="resTitle"></span>ã€‘å¾—ä¸»æ˜¯ï¼š</p>
        <span class="winner" id="winnerName"></span>
        <button class="spin-btn" style="padding:10px 30px" onclick="closeModal()">æ”¶ä¸‹å¥½é‹</button>
    </div>
</div>

<audio id="tickSound" src="https://assets.mixkit.co/active_storage/sfx/2005/2005-preview.mp3"></audio>
<audio id="winSound" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3"></audio>

<script>
    const canvas = document.getElementById('wheelCanvas');
    const ctx = canvas.getContext('2d');
    const tagContainer = document.getElementById('tagContainer');
    const tickSound = document.getElementById('tickSound');
    const winSound = document.getElementById('winSound');
    
    let names = ['ç‹å°æ˜', 'æå¤§è¯', 'å¼µä¸‰', 'é™³ç¾', 'æ—åŒå­¸'];
    let currentRotation = 0;
    const colors = ['#FF6B6B', '#4834D4', '#6AB04C', '#F0932B', '#EB4D4B', '#22A6B3', '#BE2EDD'];

    // è§£æ±ºæ¨¡ç³Šå•é¡Œï¼šæ ¹æ“š Device Pixel Ratio èª¿æ•´ Canvas å°ºå¯¸
    function setupCanvas() {
        const size = 320;
        const dpr = window.devicePixelRatio || 1;
        canvas.width = size * dpr;
        canvas.height = size * dpr;
        ctx.scale(dpr, dpr);
        drawWheel();
    }

    function renderTags() {
        tagContainer.innerHTML = '';
        names.forEach((name, index) => {
            const tag = document.createElement('div');
            tag.className = 'tag';
            tag.innerHTML = `${name} <span class="remove-btn" onclick="removeName(${index})">Ã—</span>`;
            tagContainer.appendChild(tag);
        });
        drawWheel();
    }

    function addName() {
        const input = document.getElementById('nameInput');
        if (input.value.trim()) {
            names.push(input.value.trim());
            input.value = '';
            renderTags();
        }
    }

    function removeName(index) {
        names.splice(index, 1);
        renderTags();
    }

    function drawWheel() {
        const n = names.length;
        if (n === 0) return;
        const centerX = 160, centerY = 160, radius = 160;
        const arc = (2 * Math.PI) / n;

        ctx.clearRect(0, 0, 320, 320);

        names.forEach((name, i) => {
            const angle = i * arc;
            ctx.beginPath();
            ctx.fillStyle = colors[i % colors.length];
            ctx.moveTo(centerX, centerY);
            ctx.arc(centerX, centerY, radius, angle, angle + arc);
            ctx.fill();

            // ç¹ªè£½æ–‡å­—
            ctx.save();
            ctx.translate(centerX, centerY);
            ctx.rotate(angle + arc / 2);
            ctx.textAlign = "right";
            ctx.fillStyle = "white";
            ctx.font = "bold 18px Arial"; // æé«˜å­—é«”å¤§å°èˆ‡æ¸…æ™°åº¦
            ctx.fillText(name, radius - 20, 7);
            ctx.restore();
        });
    }

    let isSpinning = false;
    function spin() {
        if (isSpinning || names.length < 2) return;
        isSpinning = true;
        document.getElementById('spinBtn').disabled = true;

        const extraDegrees = 2000 + Math.random() * 2000;
        currentRotation += extraDegrees;
        canvas.style.transform = `rotate(${currentRotation}deg)`;

        // æ—‹è½‰éŸ³æ•ˆæ¨¡æ“¬ï¼ˆç°¡å–®é–“éš”æ’­æ”¾ï¼‰
        const interval = setInterval(() => {
            tickSound.currentTime = 0;
            tickSound.play().catch(()=>{});
        }, 200);

        setTimeout(() => {
            clearInterval(interval);
            const n = names.length;
            const actualRotation = currentRotation % 360;
            const sliceSize = 360 / n;
            // ä¿®æ­£åç§»é‡ï¼ŒæŒ‡é‡åœ¨ä¸Šæ–¹(270åº¦)
            const winningIndex = Math.floor((360 - (actualRotation % 360) + 270) % 360 / sliceSize);
            
            showResult(names[winningIndex]);
        }, 4000);
    }

    function showResult(winner) {
        winSound.play();
        document.getElementById('winnerName').innerText = winner;
        document.getElementById('resTitle').innerText = document.getElementById('titleInput').value;
        document.getElementById('modalOverlay').style.display = 'flex';
        setTimeout(() => document.getElementById('modal').classList.add('active'), 10);
    }

    function closeModal() {
        document.getElementById('modal').classList.remove('active');
        setTimeout(() => {
            document.getElementById('modalOverlay').style.display = 'none';
            document.getElementById('spinBtn').disabled = false;
            isSpinning = false;
        }, 300);
    }

    // åˆå§‹åŒ–
    window.onload = () => {
        setupCanvas();
        renderTags();
    };
</script>

</body>
</html>
